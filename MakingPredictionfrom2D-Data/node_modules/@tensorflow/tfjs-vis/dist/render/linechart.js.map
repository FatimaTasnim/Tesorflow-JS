{"version":3,"file":"linechart.js","sourceRoot":"","sources":["../../src/render/linechart.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright 2018 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport embed, {Mode, VisualizationSpec} from 'vega-embed';\n\nimport {Drawable, Point2D, XYPlotData, XYPlotOptions} from '../types';\n\nimport {getDrawArea} from './render_utils';\n\n/**\n * Renders a line chart\n *\n * ```js\n * const series1 = Array(100).fill(0)\n *   .map(y => Math.random() * 100 - (Math.random() * 50))\n *   .map((y, x) => ({ x, y, }));\n *\n * const series2 = Array(100).fill(0)\n *   .map(y => Math.random() * 100 - (Math.random() * 150))\n *   .map((y, x) => ({ x, y, }));\n *\n * const series = ['First', 'Second'];\n * const data = { values: [series1, series2], series }\n *\n * const surface = { name: 'Line chart', tab: 'Charts' };\n * tfvis.render.linechart(surface, data);\n * ```\n *\n * ```js\n * const series1 = Array(100).fill(0)\n *   .map(y => Math.random() * 100 + 50)\n *   .map((y, x) => ({ x, y, }));\n *\n * const data = { values: [series1] }\n *\n * // Render to visor\n * const surface = { name: 'Zoomed Line Chart', tab: 'Charts' };\n * tfvis.render.linechart(surface, data, { zoomToFit: true });\n * ```\n *\n */\n/** @doc {heading: 'Charts', namespace: 'render'} */\nexport async function linechart(\n    container: Drawable, data: XYPlotData,\n    opts: XYPlotOptions = {}): Promise<void> {\n  let inputArray = data.values;\n  const _series = data.series == null ? [] : data.series;\n\n  // Nest data if necessary before further processing\n  inputArray = Array.isArray(inputArray[0]) ? inputArray as Point2D[][] :\n                                              [inputArray] as Point2D[][];\n\n  const values: Point2D[] = [];\n  const seriesNames = new Set();\n  inputArray.forEach((seriesData, i) => {\n    const seriesName: string =\n        _series[i] != null ? _series[i] : `Series ${i + 1}`;\n    seriesNames.add(seriesName);\n    const seriesVals =\n        seriesData.map(v => Object.assign({}, v, {series: seriesName}));\n    values.push(...seriesVals);\n  });\n\n  const drawArea = getDrawArea(container);\n  const options = Object.assign({}, defaultOpts, opts);\n\n  const embedOpts = {\n    actions: false,\n    mode: 'vega-lite' as Mode,\n    defaultStyle: false,\n  };\n\n  const yScale = (): {}|undefined => {\n    if (options.zoomToFit) {\n      return {'zero': false};\n    } else if (options.yAxisDomain != null) {\n      return {'domain': options.yAxisDomain};\n    }\n    return undefined;\n  };\n\n  // tslint:disable-next-line:no-any\n  const encodings: any = {\n    'x': {\n      'field': 'x',\n      'type': options.xType,\n      'title': options.xLabel,\n    },\n    'y': {\n      'field': 'y',\n      'type': options.yType,\n      'title': options.yLabel,\n      'scale': yScale(),\n    },\n    'color': {\n      'field': 'series',\n      'type': 'nominal',\n      'legend': {'values': Array.from(seriesNames)}\n    },\n  };\n\n  // tslint:disable-next-line:no-any\n  let domainFilter: any;\n  if (options.yAxisDomain != null) {\n    domainFilter = {'filter': {'field': 'y', 'range': options.yAxisDomain}};\n  }\n\n  const spec: VisualizationSpec = {\n\n    'width': options.width || drawArea.clientWidth,\n    'height': options.height || drawArea.clientHeight,\n    'padding': 0,\n    'autosize': {\n      'type': 'fit',\n      'contains': 'padding',\n      'resize': true,\n    },\n    'config': {\n      'axis': {\n        'labelFontSize': options.fontSize,\n        'titleFontSize': options.fontSize,\n      },\n      'text': {'fontSize': options.fontSize},\n      'legend': {\n        'labelFontSize': options.fontSize,\n        'titleFontSize': options.fontSize,\n      }\n    },\n    'data': {'values': values},\n    'layer': [\n      {\n        // Render the main line chart\n        'mark': {\n          'type': 'line',\n          'clip': true,\n        },\n        'encoding': encodings,\n      },\n      {\n        // Render invisible points for all the the data to make selections\n        // easier\n        'mark': {'type': 'point'},\n        // 'encoding': encodings,\n        // If a custom domain is set, filter out the values that will not\n        // fit we do this on the points and not the line so that the line\n        // still appears clipped for values outside the domain but we can\n        // still operate on an unclipped set of points.\n        'transform': options.yAxisDomain ? [domainFilter] : undefined,\n        'selection': {\n          'nearestPoint': {\n            'type': 'single',\n            'on': 'mouseover',\n            'nearest': true,\n            'empty': 'none',\n            'encodings': ['x'],\n          },\n        },\n        'encoding': Object.assign({}, encodings, {\n          'opacity': {\n            'value': 0,\n            'condition': {\n              'selection': 'nearestPoint',\n              'value': 1,\n            },\n          }\n        }),\n      },\n      {\n        // Render a tooltip where the selection is\n        'transform': [\n          {'filter': {'selection': 'nearestPoint'}},\n          domainFilter\n        ].filter(Boolean),  // remove undefineds from array\n        'mark': {\n          'type': 'text',\n          'align': 'left',\n          'dx': 5,\n          'dy': -5,\n          'color': 'black',\n        },\n        'encoding': Object.assign({}, encodings, {\n          'text': {\n            'type': options.xType,\n            'field': 'y',\n            'format': '.6f',\n          },\n          // Unset text color to improve readability\n          'color': undefined,\n        }),\n      },\n      {\n        // Draw a vertical line where the selection is\n        'transform': [{'filter': {'selection': 'nearestPoint'}}],\n        'mark': {'type': 'rule', 'color': 'gray'},\n        'encoding': {\n          'x': {\n            'type': options.xType,\n            'field': 'x',\n          }\n        }\n      },\n    ],\n  };\n\n  await embed(drawArea, spec, embedOpts);\n  return Promise.resolve();\n}\n\nconst defaultOpts = {\n  xLabel: 'x',\n  yLabel: 'y',\n  xType: 'quantitative',\n  yType: 'quantitative',\n  zoomToFit: false,\n  fontSize: 11,\n};\n"]}